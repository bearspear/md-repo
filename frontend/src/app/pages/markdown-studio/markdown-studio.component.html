<!-- Studio Toolbar -->
<mat-toolbar class="studio-toolbar" color="primary">
  <span class="toolbar-title">
    <mat-icon>edit_note</mat-icon>
    Markdown Studio
  </span>

  <span class="spacer"></span>

  <button mat-button (click)="newDocument()" matTooltip="New Document">
    <mat-icon>note_add</mat-icon>
    New
  </button>

  <button mat-button (click)="importDocument()" matTooltip="Import File">
    <mat-icon>upload_file</mat-icon>
    Import
  </button>

  <button mat-button (click)="saveDocument()" matTooltip="Save (Ctrl+S)">
    <mat-icon>save</mat-icon>
    Save
    <span *ngIf="hasUnsavedChanges" class="unsaved-indicator">*</span>
  </button>

  <button mat-button (click)="exportDocument()" matTooltip="Export Document">
    <mat-icon>download</mat-icon>
    Export
  </button>

  <button mat-button (click)="uploadImage()" matTooltip="Upload Image">
    <mat-icon>image</mat-icon>
    Image
  </button>

  <button mat-button (click)="importImageFromUrl()" matTooltip="Import Image from URL">
    <mat-icon>link</mat-icon>
    URL
  </button>

  <mat-divider [vertical]="true" class="toolbar-divider"></mat-divider>

  <button mat-icon-button (click)="toggleGallery()" matTooltip="Toggle Image Gallery">
    <mat-icon>{{ showGallery ? 'photo_library' : 'collections' }}</mat-icon>
  </button>

  <button mat-icon-button (click)="toggleSidebar()" matTooltip="Toggle Sidebar">
    <mat-icon>{{ showSidebar ? 'menu_open' : 'menu' }}</mat-icon>
  </button>

  <button mat-icon-button (click)="togglePreview()" matTooltip="Toggle Preview">
    <mat-icon>{{ showPreview ? 'visibility' : 'visibility_off' }}</mat-icon>
  </button>

  <button mat-icon-button (click)="toggleFullscreen()" matTooltip="Toggle Fullscreen (F11)">
    <mat-icon>{{ isFullscreen ? 'fullscreen_exit' : 'fullscreen' }}</mat-icon>
  </button>
</mat-toolbar>

<!-- Three-Pane Layout -->
<div class="studio-container" [class.fullscreen]="isFullscreen">

  <!-- Left Sidebar (TOC) -->
  <aside class="sidebar" *ngIf="showSidebar" #sidebar>
    <div class="sidebar-header">
      <h3>Table of Contents</h3>
    </div>
    <div class="sidebar-content">
      <div *ngIf="tocItems.length === 0" class="placeholder-text">
        Start typing headings to build the table of contents...
      </div>
      <nav *ngIf="tocItems.length > 0" class="toc-nav">
        <div
          *ngFor="let item of tocItems"
          class="toc-item toc-level-{{ item.level }}"
          (click)="scrollToHeading(item.id)"
          [attr.title]="item.text">
          {{ item.text }}
        </div>
      </nav>
    </div>
  </aside>

  <!-- Resize Handle 1: Sidebar <=> Editor -->
  <div class="resize-handle" *ngIf="showSidebar"
       (mousedown)="onResizeStart($event, 'sidebar')"
       matTooltip="Drag to resize">
    <div class="resize-handle-line"></div>
  </div>

  <!-- Middle Pane - Editor -->
  <div class="editor-pane" #editorPane
       (dragover)="onDragOver($event)"
       (dragleave)="onDragLeave($event)"
       (drop)="onDrop($event)"
       [class.dragging-over]="isDraggingOver">
    <div class="editor-header">
      <input
        type="text"
        [(ngModel)]="documentTitle"
        class="document-title-input"
        placeholder="Document Title"
      />
    </div>

    <!-- Enhanced Markdown Editor with Comprehensive Toolbar -->
    <app-markdown-editor
      [(editedContent)]="markdownContent"
      [previewMode]="getEditorMode()"
      [isSaving]="false"
      [hasUnsavedChanges]="hasUnsavedChanges"
      [lastSavedAt]="lastSaved"
      [showSaveControls]="false"
      (contentChange)="onContentChange()"
      (insertMarkdown)="insertMarkdown($event)"
      (undo)="performUndo()"
      (redo)="performRedo()"
      (discardChanges)="discardChanges()"
      (saveDocument)="saveDocument()">
    </app-markdown-editor>

    <!-- Drag & Drop Overlay -->
    <div class="drag-drop-overlay" *ngIf="isDraggingOver">
      <div class="drag-drop-content">
        <mat-icon class="drag-icon">cloud_upload</mat-icon>
        <p class="drag-text">Drop images here to upload</p>
      </div>
    </div>
  </div>

  <!-- Resize Handle 2: Editor <=> Preview -->
  <div class="resize-handle" *ngIf="showPreview"
       (mousedown)="onResizeStart($event, 'editor')"
       matTooltip="Drag to resize">
    <div class="resize-handle-line"></div>
  </div>

  <!-- Right Pane - Preview -->
  <div class="preview-pane" *ngIf="showPreview">
    <div class="preview-header">
      <h3>
        <mat-icon>visibility</mat-icon>
        Preview
      </h3>
    </div>

    <div class="preview-container" #previewContainer>
      <markdown [data]="previewContent" [disableSanitizer]="true"></markdown>
    </div>
  </div>

  <!-- Gallery Pane -->
  <div class="gallery-pane" *ngIf="showGallery">
    <app-image-gallery (imageSelected)="onImageSelected($event)"></app-image-gallery>
  </div>

</div>
