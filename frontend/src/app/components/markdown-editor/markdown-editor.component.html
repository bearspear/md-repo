<div class="editor-container">
  <!-- Markdown Toolbar -->
  <div class="editor-toolbar">
    <!-- Undo/Redo -->
    <button mat-icon-button (click)="onUndo()" matTooltip="Undo (Ctrl+Z)">
      <mat-icon>undo</mat-icon>
    </button>
    <button mat-icon-button (click)="onRedo()" matTooltip="Redo (Ctrl+Y)">
      <mat-icon>redo</mat-icon>
    </button>

    <mat-divider [vertical]="true" style="height: 24px; margin: 0 8px;"></mat-divider>

    <!-- Text Formatting -->
    <button mat-icon-button (click)="onInsertMarkdown('bold')" matTooltip="Bold (Ctrl+B)">
      <mat-icon>format_bold</mat-icon>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('italic')" matTooltip="Italic (Ctrl+I)">
      <mat-icon>format_italic</mat-icon>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('strikethrough')" matTooltip="Strikethrough">
      <mat-icon>format_strikethrough</mat-icon>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('inline-code')" matTooltip="Inline Code">
      <mat-icon>code</mat-icon>
    </button>

    <mat-divider [vertical]="true" style="height: 24px; margin: 0 8px;"></mat-divider>

    <!-- Headings -->
    <button mat-icon-button (click)="onInsertMarkdown('h1')" matTooltip="Heading 1">
      <span class="heading-text">H1</span>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('h2')" matTooltip="Heading 2">
      <span class="heading-text">H2</span>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('h3')" matTooltip="Heading 3">
      <span class="heading-text">H3</span>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('h4')" matTooltip="Heading 4">
      <span class="heading-text">H4</span>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('h5')" matTooltip="Heading 5">
      <span class="heading-text">H5</span>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('h6')" matTooltip="Heading 6">
      <span class="heading-text">H6</span>
    </button>

    <mat-divider [vertical]="true" style="height: 24px; margin: 0 8px;"></mat-divider>

    <!-- Lists -->
    <button mat-icon-button (click)="onInsertMarkdown('ul')" matTooltip="Unordered List">
      <mat-icon>format_list_bulleted</mat-icon>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('ol')" matTooltip="Ordered List">
      <mat-icon>format_list_numbered</mat-icon>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('task')" matTooltip="Task List">
      <mat-icon>check_box</mat-icon>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('indent')" matTooltip="Increase Indent">
      <mat-icon>format_indent_increase</mat-icon>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('outdent')" matTooltip="Decrease Indent">
      <mat-icon>format_indent_decrease</mat-icon>
    </button>

    <mat-divider [vertical]="true" style="height: 24px; margin: 0 8px;"></mat-divider>

    <!-- Links & Media -->
    <button mat-icon-button (click)="onInsertMarkdown('link')" matTooltip="Link (Ctrl+K)">
      <mat-icon>link</mat-icon>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('image')" matTooltip="Image">
      <mat-icon>image</mat-icon>
    </button>

    <mat-divider [vertical]="true" style="height: 24px; margin: 0 8px;"></mat-divider>

    <!-- Block Elements -->
    <button mat-icon-button (click)="onInsertMarkdown('blockquote')" matTooltip="Blockquote">
      <mat-icon>format_quote</mat-icon>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('code-block')" matTooltip="Code Block">
      <mat-icon>code_blocks</mat-icon>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('table')" matTooltip="Table">
      <mat-icon>table_chart</mat-icon>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('hr')" matTooltip="Horizontal Rule">
      <mat-icon>horizontal_rule</mat-icon>
    </button>

    <mat-divider [vertical]="true" style="height: 24px; margin: 0 8px;"></mat-divider>

    <!-- Special -->
    <button mat-icon-button (click)="onInsertMarkdown('footnote')" matTooltip="Footnote">
      <mat-icon>notes</mat-icon>
    </button>
    <button mat-icon-button (click)="onInsertMarkdown('emoji')" matTooltip="Emoji">
      <mat-icon>sentiment_satisfied</mat-icon>
    </button>

    <mat-divider [vertical]="true" style="height: 24px; margin: 0 8px;"></mat-divider>

    <!-- Tools -->
    <button mat-icon-button (click)="onToggleFindReplace()" matTooltip="Find & Replace (Ctrl+F)">
      <mat-icon>search</mat-icon>
    </button>
    <button mat-icon-button (click)="onShowKeyboardShortcuts()" matTooltip="Keyboard Shortcuts">
      <mat-icon>keyboard</mat-icon>
    </button>

    <span class="toolbar-spacer"></span>

    <!-- Save Status -->
    <ng-container *ngIf="showSaveControls">
      <span class="save-status">
        <mat-icon *ngIf="isSaving">hourglass_empty</mat-icon>
        <mat-icon *ngIf="!isSaving && !hasUnsavedChanges && lastSavedAt">check_circle</mat-icon>
        <mat-icon *ngIf="hasUnsavedChanges && !isSaving">edit</mat-icon>
        <span *ngIf="isSaving">Saving...</span>
        <span *ngIf="!isSaving && !hasUnsavedChanges && lastSavedAt">
          Saved {{ lastSavedAt | date:'short' }}
        </span>
        <span *ngIf="hasUnsavedChanges && !isSaving">Unsaved changes</span>
      </span>

      <button mat-stroked-button (click)="onDiscardChanges()" [disabled]="!hasUnsavedChanges">
        Discard
      </button>
      <button mat-raised-button color="primary" (click)="onSaveDocument()" [disabled]="!hasUnsavedChanges || isSaving">
        Save
      </button>
    </ng-container>
  </div>

  <!-- Find & Replace Panel -->
  <div class="find-replace-panel" *ngIf="showFindReplace">
    <div class="find-replace-row">
      <mat-icon class="find-icon">search</mat-icon>
      <input
        type="text"
        class="find-input"
        [(ngModel)]="findText"
        (ngModelChange)="onFindTextChange()"
        placeholder="Find"
        (keydown.enter)="onFindNext()"
        (keydown.escape)="onToggleFindReplace()"
        #findInput>
      <button mat-icon-button (click)="onFindPrevious()" matTooltip="Previous (Shift+Enter)">
        <mat-icon>keyboard_arrow_up</mat-icon>
      </button>
      <button mat-icon-button (click)="onFindNext()" matTooltip="Next (Enter)">
        <mat-icon>keyboard_arrow_down</mat-icon>
      </button>
      <span class="find-count" *ngIf="findText">{{ currentMatchIndex + 1 }} of {{ totalMatches }}</span>
      <button mat-icon-button (click)="onToggleFindReplace()" matTooltip="Close (Esc)">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="replace-row" *ngIf="showReplace">
      <mat-icon class="replace-icon">find_replace</mat-icon>
      <input
        type="text"
        class="replace-input"
        [(ngModel)]="replaceText"
        (ngModelChange)="onReplaceTextChange()"
        placeholder="Replace"
        (keydown.enter)="onReplaceNext()"
        (keydown.escape)="onToggleFindReplace()">
      <button mat-button (click)="onReplaceNext()">Replace</button>
      <button mat-button (click)="onReplaceAll()">Replace All</button>
    </div>
  </div>

  <!-- Markdown Editor Textarea -->
  <div class="editor-wrapper">
    <textarea
      #editorTextarea
      class="editor-textarea"
      [class.typewriter-mode]="typewriterMode"
      [(ngModel)]="editedContent"
      (ngModelChange)="onContentChange()"
      (click)="saveCursorPosition()"
      (keydown)="onKeyDown($event)"
      (paste)="onPaste($event)"
      placeholder="Edit markdown content here...">
    </textarea>

    <!-- Autocomplete Dropdown -->
    <div
      class="autocomplete-dropdown"
      *ngIf="showAutocomplete"
      [style.top.px]="autocompletePosition.top"
      [style.left.px]="autocompletePosition.left">
      <div
        *ngFor="let option of autocompleteOptions; let i = index"
        class="autocomplete-item"
        [class.selected]="i === selectedAutocompleteIndex"
        (click)="selectAutocomplete(i)"
        (mouseenter)="selectedAutocompleteIndex = i">
        <div class="autocomplete-label">{{ option.label }}</div>
        <div class="autocomplete-description">{{ option.description }}</div>
      </div>
    </div>
  </div>
</div>
